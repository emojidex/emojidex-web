class ReplacerService extends Replacer
  constructor: (@element, @options) ->
    super
    @element = $(@element)

  replace: (callback) ->
    if @options.loadingIcon
      @setLoadingIcon()
    else
      @getEmojiDataFromAPI @onLoadEmojiData
    @

  onLoadEmojiData: (emoji_data) =>
    # fix data for At.js --------
    for emoji in emoji_data
      emoji.code = emoji.code.replace RegExp(" ", "g"), "_"
      emoji.img_url = "http://cdn.emojidex.com/emoji/px32/#{emoji.code}.png"

    @emoji_data = emoji_data
    @emoji_regexps = @setEmojiCSS_getEmojiRegexps emoji_data
    @setEmojiIcon @
    callback? @

  setLoadingIcon: ->
    searchEmoji = (element) =>
      setEmojiIcon = (loading_element, term) =>
        ec.Search.search term, (emoji_data) =>
          for emoji in emoji_data
            if emoji.code.replace(/\s/g, "_") is term
              console.log emoji
              loading_element.replaceWith @getEmojiTag term, "background-image: url(http://cdn.emojidex.com/emoji/px32/#{term}.png)"

      ec = new EmojidexClient
      loading_elements = element.find ".emojidex-loading-icon"
      for loading_element in loading_elements
        if loading_element.dataset.type is 'code'
          setEmojiIcon $(loading_element), loading_element.dataset.emoji.replace /:/g, ''

    setLoadingTag = (text) ->
      getImgTagWithEmojiData = (emoji_data, type) ->
        "<img class='emojidex-loading-icon' data-emoji='#{emoji_data}' data-type='#{type}'></img>"

      # need update when new utf emoji added --------
      regexp_utf = 'âœ…|ðŸŽ­|ðŸŽµ|ðŸŽ¶|ðŸ’˜|ðŸ’¡|ðŸ’¢|ðŸ’¤|ðŸ’¥|ðŸ’§|ðŸ’¨|ðŸ’©|ðŸ’ª|ðŸ’«|ðŸ’¯|ðŸ’²|ðŸ’¹|ðŸ“ˆ|ðŸ“§|ðŸ“©|ðŸ”€|ðŸ”|ðŸ”„|ðŸ”‡|ðŸ”‰|ðŸ”–|ðŸ”—|ðŸ”™|ðŸ”š|ðŸ”›|ðŸ”œ|ðŸ”|ðŸ”¡|ðŸ”¢|ðŸ”£|ðŸ”¤|ðŸ”¥|ðŸ”²|ðŸ”³|ðŸ”µ|ðŸ”¶|ðŸ”·|ðŸ”¸|ðŸ”¹|ðŸ”º|ðŸ”»|ðŸ”½|ðŸ—¤|ðŸ—¥|ðŸ—§|ðŸ—¨|ðŸ—©|ðŸ—ª|ðŸ—«|ðŸ—¬|ðŸ—­|ðŸ—¯|ðŸ—¯|ðŸ—±|ðŸ—µ|ðŸ—¶|ðŸ—·|ðŸ—¸|ðŸ—¹|â†”|â†–|â†—|â†˜|â†™|â†ª|â¬|â–ª|â–«|â—»|â—¼|â˜‘|âœ”|âœ–|âœ³|âœ´|âŒ|âž–|âž—|â¤´|â¤µ|â¬›|â¬œ|â­|â­•|ðŸ’’|ðŸ’“|ðŸ’”|ðŸ’•|ðŸ’–|ðŸ’—|ðŸ’™|ðŸ’š|ðŸ’›|ðŸ’œ|ðŸ’|ðŸ’ž|ðŸ’Ÿ|ðŸ’¦|ðŸ’¬|ðŸ’­|ðŸ’®|ðŸ’±|ðŸ“‰|ðŸ“Š|ðŸ“¤|ðŸ“¥|ðŸ“¶|ðŸ”‚|ðŸ”ƒ|ðŸ”…|ðŸ”†|ðŸ”Š|ðŸ”•|ðŸ”˜|ðŸ”ž|ðŸ” |ðŸ”´|ðŸ”¼|ðŸ”¾|ðŸ”¿|ðŸ— |ðŸ—¦|ðŸ—°|ðŸ—²|ðŸ—´|ðŸš«|â€¼|â‰|â†•|â©|âª|â«|â–¶|â—€|âšª|âš«|â›”|âœ¨|â‡|âŽ|â“|â”|â•|â—|â¤|âž•|âž¡|âž°|â¬…|â¬†|â¬‡|ã€°|â†©|â—½|â—¾|â˜™|â›‹|ã€½ï¸|ãŠ™|ðŸ…¿|ðŸ†’|ðŸ†“|ðŸ†”|ðŸ†•|ðŸ†–|ðŸ†—|ðŸ†˜|ðŸ†™|ðŸ†š|ðŸ‡´|ðŸ‡µ|ðŸ‡¶|ðŸ‡·|ðŸ‡¸|ðŸ‡¹|ðŸ‡º|ðŸ‡»|ðŸ‡¼|ðŸ‡½|ðŸ‡¾|ðŸ‡¿|ðŸ‡¨ðŸ‡³|ðŸ‡©ðŸ‡ª|ðŸ‡ªðŸ‡¸|ðŸ‡«ðŸ‡·|ðŸ‡¬ðŸ‡§|ðŸ‡®ðŸ‡¹|ðŸ‡¯ðŸ‡µ|ðŸ‡°ðŸ‡·|ðŸ‡·ðŸ‡º|ðŸ‡ºðŸ‡¸|ðŸˆ|ðŸˆ‚|ðŸˆš|ðŸˆ¯|ðŸˆ²|ðŸˆ³|ðŸˆ´|ðŸˆµ|ðŸˆ¶|ðŸˆ·|ðŸˆ¸|ðŸˆ¹|ðŸˆº|ðŸ‰|ðŸ‰‘|ðŸ“²|ðŸ•…|ðŸ—•|ðŸ—–|ðŸ——|ðŸ—™|ðŸ—š|ðŸ—›|ðŸ—œ|ðŸ—|ðŸ—ž|ðŸ—Ÿ|ðŸ—³|ðŸ—º|ðŸš©|ðŸš¬|ðŸš®|ðŸš±|ðŸš¹|ðŸšº|ðŸš»|ðŸš¾|#ï¸âƒ£|ï¸1ï¸âƒ£|ï¸2ï¸âƒ£|ï¸3ï¸âƒ£|ï¸4ï¸âƒ£|ï¸5ï¸âƒ£|ï¸6ï¸âƒ£|ï¸7ï¸âƒ£|ï¸8ï¸âƒ£|ï¸9ï¸âƒ£|ï¸0ï¸âƒ£|â„¢|â“‚ï¸|â™ˆ|â™‰|â™Š|â™‹|â™Œ|â™|â™Ž|â™“|â™ |â™£|â™¥|âš |âž¿|ðŸ…°|ðŸ…±|ðŸ…¾|ðŸ†Ž|ðŸ†‘|ðŸ‡¦|ðŸ‡§|ðŸ‡¨|ðŸ‡©|ðŸ‡ª|ðŸ‡«|ðŸ‡¬|ðŸ‡­|ðŸ‡®|ðŸ‡¯|ðŸ‡°|ðŸ‡±|ðŸ‡²|ðŸ‡³|ðŸ“³|ðŸ“´|ðŸ“µ|ðŸ”Ÿ|ðŸ•‰|ðŸ•²|ðŸ—˜|ðŸš­|ðŸš¯|ðŸš°|ðŸš³|ðŸš·|ðŸš¸|ðŸš¼|ðŸ›‚|ðŸ›ƒ|ðŸ›„|ðŸ›…|Â©|Â®|â„¹|â™|â™|â™‘|â™’|â™¦|â™»|â™¿|â›Ž|âœ¡|ãŠ—|ðŸ•€|ðŸ•|ðŸ•‚|ðŸ•ƒ|ðŸ•„|â˜Š|â˜‹|â˜Œ|â˜|â˜ |â˜¡|â˜¢|â˜£|â˜¤|â˜¥|â˜¦|â˜§|â˜¨|â˜©|â˜ª|â˜«|â˜¬|â˜­|â˜®|â˜¯|â˜°|â˜±|â˜²|â˜³|â˜´|â˜µ|â˜¶|â˜·|â˜¸|â˜¿|â™€|â™|â™‚|â™ƒ|â™„|â™…|â™†|â™‡|â™”|â™•|â™–|â™—|â™˜|â™™|â™š|â™›|â™œ|â™|â™ž|â™Ÿ|â™©|â™¬|â™­|â™®|â™¯|â™°|â™±|â™³|â™´|â™µ|â™¶|â™·|â™¸|â™¹|â™º|â™¼|â™½|âš†|âš‡|âšˆ|âš‰|âšŠ|âš‹|âšŒ|âš|âšŽ|âš|âš’|âš”|âš•|âš–|âš—|âš˜|âš™|âš›|âšœ|âš|âšž|âšŸ|âš¢|âš£|âš¤|âš¥|âš¦|âš§|âš¨|âš©|âš­|âš®|âš¯|âš±|âš²|âš³|âš´|âšµ|âš¶|âš·|âš¸|âš¹|âšº|âš»|âš¼|â›‡|â›Œ|â›|â›|â›|â›‘|â›’|â›“|â›•|â›–|â›—|â›˜|â›™|â›š|â››|â›œ|â›|â›ž|â›Ÿ|â› |â›¡|â›£|â›¤|â›§|â›­|â›®|â›¯|â›¶|â›¼|â›¿|ðŸŒ¬|ðŸŽ…|ðŸ‚|ðŸƒ|ðŸ„|ðŸ‡|ðŸŠ|ðŸ‹|ðŸŒ|ðŸ|ðŸŽ|ðŸ‘€|ðŸ‘|ðŸ‘‚|ðŸ‘ƒ|ðŸ—¢|ðŸ‘…|ðŸ‘£|ðŸ‘¦|ðŸ‘§|ðŸ‘¨|ðŸ‘©|ðŸ‘ª|ðŸ‘«|ðŸ‘¬|ðŸ‘­|ðŸ‘®|ðŸ‘¯|ðŸ‘±|ðŸ‘²|ðŸ‘´|ðŸ‘µ|ðŸ‘¶|ðŸ‘¸|ðŸ‘»|ðŸ‘¼|ðŸ‘½|ðŸ‘¾|ðŸ‘¿|ðŸ’€|ðŸ’|ðŸ’‚|ðŸ’ƒ|ðŸ’†|ðŸ’‡|ðŸ’|ðŸ—£|ðŸš´|ðŸš¶|ðŸ‘¤|ðŸ‘¥|ðŸ‘°|ðŸ‘³|ðŸ‘·|ðŸ‘¹|ðŸ‘º|ðŸ’‘|ðŸ•´|ðŸ•µ|ðŸšµ|â›¸|â›¹|ðŸ˜‚ðŸ¾|ðŸ˜‹ðŸ¾|ðŸ˜™ðŸ¾|ðŸ˜šðŸ¾|ðŸ˜›ðŸ¾|ðŸ˜ ðŸ¾|ðŸ˜¢ðŸ¾|ðŸ˜¥ðŸ¾|ðŸ˜©ðŸ¾|ðŸ˜ªðŸ¾|ðŸ˜­ðŸ¾|ðŸ˜¯ðŸ¾|ðŸ˜±ðŸ¾|ðŸ˜³ðŸ¾|ðŸ˜·ðŸ¾|ðŸ˜‚ðŸ¿|ðŸ˜ƒðŸ¿|ðŸ˜‰ðŸ¿|ðŸ˜‰ðŸ¾|ðŸ˜ŠðŸ¿|ðŸ˜‹ðŸ¿|ðŸ˜“ðŸ¿|ðŸ˜”ðŸ¿|ðŸ˜—ðŸ¿|ðŸ˜™ðŸ¿|ðŸ˜šðŸ¿|ðŸ˜›ðŸ¿|ðŸ˜ŸðŸ¿|ðŸ˜ ðŸ¿|ðŸ˜¢ðŸ¿|ðŸ˜¤ðŸ¿|ðŸ˜¥ðŸ¿|ðŸ˜¨ðŸ¿|ðŸ˜©ðŸ¿|ðŸ˜ªðŸ¿|ðŸ˜¬ðŸ¿|ðŸ˜­ðŸ¿|ðŸ˜¯ðŸ¿|ðŸ˜±ðŸ¿|ðŸ˜³ðŸ¿|ðŸ˜´ðŸ¿|ðŸ˜·ðŸ¿|ðŸ˜’ðŸ¾|ðŸ˜’ðŸ¿|â˜ºðŸ¾|â˜ºðŸ¿|ðŸ˜ŒðŸ¾|ðŸ˜ŒðŸ¿|ðŸ˜ðŸ¾|ðŸ˜ðŸ¿|ðŸ˜ðŸ¾|ðŸ˜ðŸ¿|ðŸ˜„ðŸ¾|ðŸ˜„ðŸ¿|ðŸ˜†ðŸ¾|ðŸ˜†ðŸ¿|ðŸ˜ƒðŸ¾|ðŸ˜‡ðŸ¾|ðŸ˜ŠðŸ¾|ðŸ˜ŽðŸ¾|ðŸ˜ðŸ¾|ðŸ˜‘ðŸ¾|ðŸ˜“ðŸ¾|ðŸ˜”ðŸ¾|ðŸ˜•ðŸ¾|ðŸ˜–ðŸ¾|ðŸ˜—ðŸ¾|ðŸ˜žðŸ¾|ðŸ˜ŸðŸ¾|ðŸ˜£ðŸ¾|ðŸ˜¤ðŸ¾|ðŸ˜¦ðŸ¾|ðŸ˜§ðŸ¾|ðŸ˜¨ðŸ¾|ðŸ˜«ðŸ¾|ðŸ˜¬ðŸ¾|ðŸ˜®ðŸ¾|ðŸ˜°ðŸ¾|ðŸ˜²ðŸ¾|ðŸ˜´ðŸ¾|ðŸ˜µðŸ¾|ðŸ˜¶ðŸ¾|ðŸ˜‡ðŸ¿|ðŸ˜ŽðŸ¿|ðŸ˜ðŸ¿|ðŸ˜‘ðŸ¿|ðŸ˜•ðŸ¿|ðŸ˜–ðŸ¿|ðŸ˜žðŸ¿|ðŸ˜£ðŸ¿|ðŸ˜¦ðŸ¿|ðŸ˜§ðŸ¿|ðŸ˜«ðŸ¿|ðŸ˜®ðŸ¿|ðŸ˜°ðŸ¿|ðŸ˜²ðŸ¿|ðŸ˜µðŸ¿|ðŸ˜¶ðŸ¿|ðŸ˜…ðŸ¾|ðŸ˜…ðŸ¿|ðŸ˜˜ðŸ¾|ðŸ˜˜ðŸ¿|ðŸ˜ðŸ¾|ðŸ˜ðŸ¿|ðŸ˜œðŸ¾|ðŸ˜œðŸ¿|ðŸ˜ðŸ¾|ðŸ˜ðŸ¿|ðŸ˜ðŸ½|ðŸ˜€|ðŸ˜|ðŸ˜‚|ðŸ˜ƒ|ðŸ˜„|ðŸ˜…|ðŸ˜†|ðŸ˜‡|ðŸ˜ˆ|ðŸ˜‰|ðŸ˜Š|ðŸ˜‹|ðŸ˜Œ|ðŸ˜|ðŸ˜Ž|ðŸ˜|ðŸ˜‘|ðŸ˜’|ðŸ˜“|ðŸ˜”|ðŸ˜•|ðŸ˜–|ðŸ˜—|ðŸ˜œ|ðŸ˜|ðŸ˜ž|ðŸ˜Ÿ|ðŸ˜ |ðŸ˜¡|ðŸ˜¢|ðŸ˜£|ðŸ˜¤|ðŸ˜¦|ðŸ˜§|ðŸ˜¨|ðŸ˜©|ðŸ˜ª|ðŸ˜«|ðŸ˜¬|ðŸ˜­|ðŸ˜¯|ðŸ˜°|ðŸ˜±|ðŸ˜²|ðŸ˜³|ðŸ˜´|ðŸ˜µ|ðŸ˜¶|ðŸ˜·|ðŸ˜¹|ðŸ˜¼|â˜º|ðŸ˜|ðŸ˜˜|ðŸ˜™|ðŸ˜š|ðŸ˜›|ðŸ˜¥|ðŸ˜®|ðŸ˜¸|ðŸ˜º|ðŸ˜»|ðŸ˜½|ðŸ˜¾|ðŸ˜¿|ðŸ™€|â˜¹|â˜»|ðŸŒ€|ðŸŒ|ðŸŒ‚|ðŸŒƒ|ðŸŒ„|ðŸŒ…|ðŸŒ†|ðŸŒ‡|ðŸŒˆ|ðŸŒ‰|ðŸŒŠ|ðŸŒ‹|ðŸŒ|ðŸŒŽ|ðŸŒ|ðŸŒ|â˜½|â˜¾|ðŸŒ¡|ðŸŒ¢|ðŸŒ£|ðŸŒ¤|ðŸŒ¥|ðŸŒ¦|ðŸŒ§|ðŸŒ¨|ðŸŒ©|ðŸŒª|ðŸŒ«|ðŸŒ°|ðŸŒ±|ðŸŒ²|ðŸŒ³|ðŸŒ´|ðŸŒµ|ðŸŒ¶|ðŸŒ·|ðŸŒ¸|ðŸŒ¹|ðŸŒº|ðŸŒ»|ðŸŒ¼|ðŸŒ¾|ðŸŒ¿|ðŸ€|ðŸ|ðŸ‚|ðŸƒ|ðŸ”|ðŸ€|ðŸ|ðŸ‚|ðŸƒ|ðŸ„|ðŸ…|ðŸ†|ðŸ‡|ðŸˆ|ðŸ‰|ðŸŠ|ðŸ‹|ðŸŒ|ðŸ|ðŸŽ|ðŸ|ðŸ|ðŸ‘|ðŸ’|ðŸ“|ðŸ”|ðŸ•|ðŸ–|ðŸ—|ðŸ˜|ðŸ™|ðŸš|ðŸ›|ðŸœ|ðŸ|ðŸž|ðŸŸ|ðŸ |ðŸ¡|ðŸ¢|ðŸ£|ðŸ¤|ðŸ¥|ðŸ¦|ðŸ§|ðŸ¨|ðŸ©|ðŸª|ðŸ«|ðŸ¬|ðŸ­|ðŸ®|ðŸ¯|ðŸ°|ðŸ±|ðŸ²|ðŸ³|ðŸ´|ðŸµ|ðŸ¶|ðŸ·|ðŸ¸|ðŸ¹|ðŸº|ðŸ»|ðŸ¼|ðŸ½|ðŸ¾|ðŸ¿|ðŸ•·|ðŸ—»|ðŸ—¾|â˜€|â˜|âš¡|â›„|ðŸ•Š|ðŸ•¸|â˜”|â›…|â„|â˜„|â˜…|â˜ˆ|â˜¼|â›³|â›º|âœ‰|ðŸƒ|ðŸŽ€|ðŸŽ|ðŸŽƒ|ðŸŽ„|ðŸŽ†|ðŸŽ‡|ðŸŽˆ|ðŸŽ‰|ðŸŽŠ|ðŸŽ‹|ðŸŽŒ|ðŸŽ|ðŸŽŽ|ðŸŽ|ðŸŽ|ðŸŽ‘|ðŸŽ’|ðŸŽ“|ðŸŽ”|ðŸŽ•|ðŸŽ–|ðŸŽ—|ðŸŽ˜|ðŸŽ™|ðŸŽš|ðŸŽ›|ðŸŽœ|ðŸŽ|ðŸŽž|ðŸŽŸ|ðŸŽ |ðŸŽ¡|ðŸŽ¢|ðŸŽ£|ðŸŽ¤|ðŸŽ¥|ðŸŽ¦|ðŸŽ§|ðŸŽ¨|ðŸŽ©|ðŸŽª|ðŸŽ«|ðŸŽ¬|ðŸŽ®|ðŸŽ¯|ðŸŽ°|ðŸŽ±|ðŸŽ²|ðŸŽ³|ðŸŽ´|ðŸŽ·|ðŸŽ¸|ðŸŽ¹|ðŸŽº|ðŸŽ»|ðŸŽ¼|ðŸŽ½|ðŸŽ¾|ðŸŽ¿|ðŸ€|ðŸ|ðŸ…|ðŸ†|ðŸˆ|ðŸ‰|ðŸ•|ðŸ–|ðŸ—|ðŸ˜|ðŸ™|ðŸš|ðŸ›|ðŸ±|ðŸ²|ðŸ³|ðŸ´|ðŸµ|ðŸ¶|ðŸ·|ðŸ‘‘|ðŸ‘’|ðŸ‘“|ðŸ‘”|ðŸ‘•|ðŸ‘–|ðŸ‘—|ðŸ‘˜|ðŸ‘™|ðŸ‘š|ðŸ‘›|ðŸ‘œ|ðŸ‘|ðŸ‘ž|ðŸ‘Ÿ|ðŸ‘ |ðŸ‘¡|ðŸ‘¢|ðŸ’„|ðŸ’…|ðŸ’ˆ|ðŸ’‰|ðŸ’Š|ðŸ’‹|ðŸ’|ðŸ’Ž|ðŸ’|ðŸ’°|ðŸ’³|ðŸ’´|ðŸ’µ|ðŸ’¶|ðŸ’·|ðŸ’º|ðŸ’»|ðŸ’¼|ðŸ’½|ðŸ’¾|ðŸ’¿|ðŸ“€|ðŸ“|ðŸ“…|ðŸ“†|ðŸ“‡|ðŸ“‹|ðŸ“Œ|ðŸ“Ž|ðŸ“’|ðŸ““|ðŸ“”|ðŸ“–|ðŸ“˜|ðŸ“™|ðŸ“š|ðŸ“›|ðŸ“œ|ðŸ“|ðŸ“Ÿ|ðŸ“ |ðŸ“¡|ðŸ“¢|ðŸ“£|ðŸ“¦|ðŸ“«|ðŸ“­|ðŸ“®|ðŸ“¯|ðŸ“°|ðŸ“±|ðŸ“·|ðŸ“¹|ðŸ“º|ðŸ“»|ðŸ“¼|ðŸ”ˆ|ðŸ”‹|ðŸ”Œ|ðŸ”|ðŸ”Ž|ðŸ”|ðŸ”‘|ðŸ”’|ðŸ”“|ðŸ””|ðŸ”°|ðŸ”±|ðŸ•|ðŸ•‘|ðŸ•’|ðŸ•“|ðŸ•”|ðŸ••|ðŸ•–|ðŸ•—|ðŸ•˜|ðŸ•™|ðŸ•š|ðŸ•›|ðŸ•œ|ðŸ•|ðŸ•ž|ðŸ•Ÿ|ðŸ• |ðŸ•¡|ðŸ•¢|ðŸ•£|ðŸ•¤|ðŸ•«|ðŸ•¬|ðŸ•¯|ðŸ•±|ðŸ•³|ðŸ•¹|ðŸ•»|ðŸ•¼|ðŸ•½|ðŸ•¾|ðŸ•¿|ðŸ–€|ðŸ–|ðŸ–„|ðŸ–†|ðŸ–Š|ðŸ–‹|ðŸ–§|ðŸ–¨|ðŸ–ª|ðŸ–«|ðŸ–¬|ðŸ–²|ðŸ–´|ðŸ–µ|ðŸ–¶|ðŸ–·|ðŸ–º|ðŸ–¿|ðŸ—€|ðŸ—€|ðŸ—ƒ|ðŸ—„|ðŸ—…|ðŸ—ˆ|ðŸ—‰|ðŸ—Š|ðŸ—Œ|ðŸ—|ðŸ—Ž|ðŸ—|ðŸ—|ðŸ—‘|ðŸ—¼|ðŸ—¿|ðŸš§|ðŸšª|ðŸš½|ðŸš¿|ðŸ›€|ðŸ›|âŒšï¸|âŒ›|â³|â˜Ž|â˜•|âš½|âš¾|âœ‚|âœ|âœ’|ðŸ€„|ðŸ’Œ|ðŸ’¸|ðŸ“‚|ðŸ“ƒ|ðŸ“„|ðŸ“|ðŸ“|ðŸ“|ðŸ“‘|ðŸ“•|ðŸ“—|ðŸ“ž|ðŸ“¨|ðŸ“ª|ðŸ“¬|ðŸ“¸|ðŸ“½|ðŸ“¾|ðŸ”|ðŸ”®|ðŸ”¯|ðŸ•„|ðŸ•†|ðŸ•‡|ðŸ•ˆ|ðŸ•¥|ðŸ•¦|ðŸ•§|ðŸ•¨|ðŸ•©|ðŸ•ª|ðŸ•­|ðŸ•°|ðŸ•¶|ðŸ–‚|ðŸ–ƒ|ðŸ–…|ðŸ–‡|ðŸ–ˆ|ðŸ–‰|ðŸ–Œ|ðŸ–|ðŸ–¥|ðŸ–¦|ðŸ–©|ðŸ–­|ðŸ–®|ðŸ–¯|ðŸ–°|ðŸ–±|ðŸ–³|ðŸ–¸|ðŸ–¹|ðŸ–»|ðŸ–¼|ðŸ–½|ðŸ–¾|ðŸ—‚|ðŸ—†|ðŸ—‡|ðŸ—‹|ðŸ—’|ðŸ—“|ðŸ—”|ðŸ—½|ðŸš¥|ðŸš¦|ðŸš¨|â°|â˜–|â˜—|âš€|âš|âš‚|âšƒ|âš„|âš…|âš°|â›€|â›|â›‚|â›ƒ|â›‰|â›Š|ðŸ’£|ðŸ”¦|ðŸ”§|ðŸ”¨|ðŸ”ª|ðŸ”«|ðŸ”­|ðŸ”©|ðŸ”¬|ðŸ—¡|âœŒ|ðŸ‘†|ðŸ‘‡|ðŸ‘ˆ|ðŸ‘‰|ðŸ‘Š|ðŸ‘‹|ðŸ‘Œ|ðŸ‘|ðŸ‘Ž|ðŸ‘|ðŸ–Ž|ðŸ–|ðŸ–’|ðŸ–”|ðŸ™Š|ðŸ‘|ðŸ–|ðŸ–‘|ðŸ–“|ðŸ–—|ðŸ–˜|ðŸ–™|ðŸ–š|ðŸ–›|ðŸ–œ|ðŸ–|ðŸ–ž|ðŸ–Ÿ|ðŸ– |ðŸ–¡|ðŸ–¢|ðŸ–£|ðŸ™…|ðŸ™†|ðŸ™‡|ðŸ™ˆ|ðŸ™‰|ðŸ™‹|ðŸ™Œ|ðŸ™|ðŸ™Ž|ðŸ™|â˜|âœŠ|âœ‹|ðŸ––|â˜š|â˜›|ðŸš‚|ðŸš„|ðŸš…|ðŸš”|ðŸš•|ðŸš˜|ðŸš›|ðŸšž|ðŸšŸ|ðŸš |ðŸš¡|ðŸš€|ðŸš|ðŸšƒ|ðŸš†|ðŸš‡|ðŸšˆ|ðŸš‰|ðŸšŠ|ðŸš‹|ðŸšŒ|ðŸš|ðŸšŽ|ðŸš|ðŸš|ðŸš‘|ðŸš’|ðŸš“|ðŸš–|ðŸš—|ðŸš™|ðŸšš|ðŸšœ|ðŸš|ðŸš¢|ðŸš£|ðŸš¤|ðŸš²|âš“|â›µ|âœˆ|ðŸŒ½|ðŸ„|ðŸ…|ðŸ†|ðŸ‡|ðŸˆ|ðŸ‰|ðŸŠ|ðŸ‹|ðŸŒ|ðŸ|ðŸŽ|ðŸ|ðŸ|ðŸ‘|ðŸ’|ðŸ“|ðŸ”|ðŸ•|ðŸ–|ðŸ—|ðŸ˜|ðŸ™|ðŸš|ðŸ›|ðŸœ|ðŸ|ðŸž|ðŸŸ|ðŸ |ðŸ¡|ðŸ¢|ðŸ£|ðŸ¤|ðŸ¥|ðŸ¦|ðŸ§|ðŸ¨|ðŸ©|ðŸª|ðŸ«|ðŸ¬|ðŸ­|ðŸ®|ðŸ¯|ðŸ°|ðŸ±|ðŸ²|ðŸ³|ðŸ´|ðŸµ|ðŸ¶|ðŸ·|ðŸ¸|ðŸ¹|ðŸº|ðŸ»|ðŸ¼|ðŸ½|ðŸŽ‚|â›²|â›½|ðŸœ|ðŸ|ðŸž|ðŸŸ|ðŸ |ðŸ¡|ðŸ¢|ðŸ£|ðŸ¤|ðŸ¥|ðŸ¦|ðŸ§|ðŸ¨|ðŸ©|ðŸª|ðŸ«|ðŸ¬|ðŸ­|ðŸ®|ðŸ¯|ðŸ°|â›ª|â™¨|â›©|â›¬|â›±|ðŸŒŒ|ðŸŒ’|ðŸŒ”|ðŸŒ–|ðŸŒ˜|ðŸŒ™|ðŸŒš|ðŸŒ›|ðŸŒœ|ðŸŒ|ðŸŒž|ðŸŒŸ|ðŸŒ |ðŸŒ•|ðŸŒ‘'

      text = text.replace new RegExp(regexp_utf, "g"), (matched_string) ->
        getImgTagWithEmojiData matched_string, "utf"
      text = text.replace /:([^:]+):/g, (matched_string, pattern1) ->
        getImgTagWithEmojiData matched_string, "code"

    # start setLoadingIcon --------
    @element_clone = @element.clone()

    text_nodes = @element.find(":not(iframe,textarea,script)").andSelf().contents().filter ->
      @nodeType is Node.TEXT_NODE
    for text_node in text_nodes
      text = text_node.textContent
      text = setLoadingTag text
      $(text_node).replaceWith text

    searchEmoji $ @element
    # @getEmojiDataFromAPI @onLoadEmojiData

  getEmojiDataFromAPI: (callback) ->
    loaded_num = 0
    user_names = @options.userNames
    emoji_data = []

    for user_name in user_names
      $.ajax
        url: "https://www.emojidex.com/api/v1/users/" + user_name + "/emoji"
        dataType: "json"
        type: "get"

        success: (user_emoji_json, status, xhr) ->
          emoji_data = emoji_data.concat user_emoji_json.emoji
          if ++loaded_num is user_names.length
            callback emoji_data

        error: (data) ->
          console.log "error: load json"
          console.log data
