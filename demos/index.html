<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <script src="../src/jquery.emojiarea.poe.js"></script>
    <link rel="stylesheet" href="../src/assets/libs/jquery-emojiarea/jquery.emojiarea.css">
    <link rel="stylesheet" href="stylesheet.css">
    
    <script src="../src/assets/libs/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <link href="../src/assets/libs/bootstrap-3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="../src/assets/css/emojidex.css" rel="stylesheet">

    <script src="../dist/jquery.emojidex.js"></script> 

    <script>
      $(document).ready(function(){
        $('.emojidex_replace').emojidex({
        	path_json: "../src/assets/json/utf-emoji.json",
        	path_img: "../src/assets/img/utf/",
          emojiarea: {
            plaintext: $('.emojidex-plaintext'), //emojidex_plaintext
            wysiwyg: $('.emojidex-all'), //emojidex_wysiwyg
            value_output: $('.emojidex-value_output') //emojidex_rawtext
            //emojidex #all on (wysiwyg + controls)
            //emojidex_controls #button and controls are added
            //emojidex_wysiwyg #wysiwyg editor mode (controls not enabled by default, :->search enabled)
            //emojidex_plaintext #raw text, no graphics
          }
        });
      });
    </script>
  </head>
  <body>
  
    <h1>emojidex-coffee Example</h1>
    
    <div class="example">
      <h2>Emojidex replace</h2>
      <div class="emojidex_replace">
        ğŸ›…ğŸ˜„â¤ğŸ˜¡ğŸ’Œâ¤ğŸ˜ˆğŸ‘â¤
        :octopus::boar::frog_face::test:
      </div>
    </div>

    <div class="example">
      <h2>Plain-Text</h2>
      <form>
        <textarea rows="5" class="emojidex-plaintext">Hello :neckbeard:</textarea>
      </form>
    </div>

    <div class="example">
      <h2>WYSIWYG</h2>
      <form>
        <textarea rows="5" class="emojidex-all">Hello :neckbeard:</textarea>
      </form>
      <h3>Value:</h3>
      <div class="value">
        <pre class="emojidex-value_output"></pre>
      </div>
    </div>

    <div class="imgArea">
      <script>

  (function() {

  // namespace
  window.cacheModule = window.cacheModule || {};

  // alias
  var aCacheModule = window.cacheModule;
  var storage = window.localStorage;

  // LocalStorageãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã®åˆ¤å®šå¼
  var supportStorage = storage;

  var PREFIX = 'yoheimcache:';
  var version = '?ver=3.0.3';


  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã£ã¦ã„ã‚‹å ´åˆã«ã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹ã€‚
  (function() {
    if (supportStorage) {
      var ver = storage.getItem('yoheimVersion');
      if (ver !== version) {
        storage.clear();
        storage.setItem('yoheimVersion', version);
      }
    }
  })();



  // localStorageç”¨ã®ã‚­ãƒ¼ç”Ÿæˆ
  var createKey = function(str) {return PREFIX + str + version;}
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»˜ãã®URL
  var urlWithVersion = function(url) {return url + version;}


  // å¼•æ•°ã®å†…å®¹ã‹ã‚‰ã€imgã‚¿ã‚°ã‚’ç”Ÿæˆã™ã‚‹ã€‚
  var createImgTag = function(src, cssClass, options) {
      var tag = '<img src="' + (src || '') + '" class="' + (cssClass || '') + '" ';
      for (var prop in options) {
        if (options.hasOwnProperty(prop)) {
          tag += ' ' + prop + '="' + options[prop] + '"';
        }
      }
      tag += '/>';

      return tag;
  }


  /*
    ç”»åƒã®ãƒ­ãƒ¼ãƒ‰
  */
  aCacheModule.loadImage = function(src, cssClass, options) {
    options = options || {};

    if (!supportStorage) {
      // LocalStorageãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€imgã‚¿ã‚°ã‚’å‡ºåŠ›ã™ã‚‹
      document.write(createImgTag(src, cssClass, options));
      return;
    
    } else {

      // LocalStorageã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆã€ãã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹
      var base64 = storage.getItem(createKey(src));
      if (base64) {
        document.write(createImgTag(base64, cssClass, options));
        return;
      
      } else {

        // LocalStorageã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç„¡ã„å ´åˆã¯ã€imgã‚¿ã‚°ã‚’å‡ºåŠ›ã™ã‚‹
        document.write(createImgTag(src, cssClass, options));

        // ãã—ã¦ã€ãã®å¾Œç”»åƒã‚’åˆ¥é€”å–å¾—ã—ã¦ã€LocalStorageã¸ä¿å­˜ã—ã¦ãŠã
        window.addEventListener('load', function() {

          var canvas = document.createElement("canvas");
          if (!canvas || !canvas.getContext || !canvas.getContext('2d')) {
            return;
          }
          var image = new Image();
          image.src = src;
          image.onload = function() {

            // ç”»åƒã‚’base64ã«ã™ã‚‹ãŸã‚ã«Canvasã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€
            // ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç”»åƒã¯ç„¡ç†ã‹ã‚‚ã€‚ã€‚
            var canvas = document.createElement("canvas");
            canvas.width = this.width;
            canvas.height = this.height;
            canvas.getContext('2d').drawImage(this, 0, 0);
            var base64 = canvas.toDataURL();

            storage.setItem(createKey(src), base64);
          };
        }, false);
      }
    }
  };
})();

window.cacheModule.loadImage('test.svg', 'someClass', {width: '50px', style:'float:right; padding-left:7px;'});
  </script>  
    </div>
 </body>

</html>